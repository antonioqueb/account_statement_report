<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="account_statement_wizard_form" model="ir.ui.view">
        <field name="name">account.statement.wizard.form</field>
        <field name="model">account.statement.wizard</field>
        <field name="arch" type="xml">
            <form string="Generar Estado de Cuenta">
                <div class="container-fluid p-0">
                    <!-- Header / Banner -->
                    <div class="rounded-top p-3 mb-4">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-file-text-o fa-2x me-3"/>
                            <div>
                                <h3 class="mb-0">Estado de Cuenta</h3>
                                <small class="opacity-75">Configure los parámetros para generar el reporte</small>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Cliente y Proyecto -->
                    <div class="row mx-0 mb-3">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-header bg-light py-2">
                                    <h5 class="mb-0">
                                        <i class="fa fa-user me-2 text-primary"/>Información del Cliente
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <group col="2">
                                        <field name="partner_id"
                                               options="{'no_create': True}"
                                               placeholder="Seleccione un cliente..."
                                               class="fw-bold"/>
                                        <field name="project_id"
                                               options="{'no_create': True}"
                                               optional="show"
                                               placeholder="Filtrar por proyecto..."/>
                                    </group>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Fechas -->
                    <div class="row mx-0 mb-3">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-header bg-light py-2">
                                    <h5 class="mb-0">
                                        <i class="fa fa-calendar me-2 text-primary"/>Rango de Fechas
                                        <small class="text-muted ms-2">(Opcional)</small>
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <group col="2">
                                        <field name="date_from" placeholder="Desde..."/>
                                        <field name="date_to" placeholder="Hasta..."/>
                                    </group>
                                    <div class="alert alert-light border mt-2 mb-0 py-2" role="alert">
                                        <small>
                                            <i class="fa fa-lightbulb-o me-1 text-warning"/>
                                            Si no se especifican fechas, se incluirán todos los documentos disponibles.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Opciones y Tipo de Cambio -->
                    <div class="row mx-0 mb-3">
                        <div class="col-md-6 pe-md-2">
                            <div class="card shadow-sm h-100">
                                <div class="card-header bg-light py-2">
                                    <h5 class="mb-0">
                                        <i class="fa fa-sliders me-2 text-primary"/>Opciones de Filtrado
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <group>
                                        <field name="include_draft" widget="boolean_toggle"/>
                                        <field name="include_fully_paid" widget="boolean_toggle"/>
                                    </group>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 ps-md-2">
                            <div class="card shadow-sm h-100">
                                <div class="card-header bg-light py-2">
                                    <h5 class="mb-0">
                                        <i class="fa fa-money me-2 text-primary"/>Tipo de Cambio
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <group>
                                        <field name="exchange_rate" widget="monetary_field"/>
                                    </group>
                                    <div class="alert alert-info border-0 mt-2 mb-0 py-2" role="alert">
                                        <small>
                                            <i class="fa fa-info-circle me-1"/>
                                            Tipo de cambio Banorte para conversiones
                                            <strong>USD ↔ MXN</strong>.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Selección Manual de Órdenes -->
                    <div class="row mx-0 mb-3">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-header bg-light py-2">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="mb-0">
                                            <i class="fa fa-list-ol me-2 text-primary"/>Selección de Órdenes
                                            <small class="text-muted ms-2">(Opcional — solo órdenes con saldo pendiente)</small>
                                        </h5>
                                        <button name="action_select_all_open"
                                                type="object"
                                                class="btn btn-sm btn-outline-primary"
                                                icon="fa-check-square-o"
                                                string="Seleccionar Todas las Abiertas"
                                                invisible="not partner_id"/>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <field name="available_order_ids" invisible="1"/>
                                    <field name="order_ids"
                                           widget="many2many_tags"
                                           domain="[('id', 'in', available_order_ids)]"
                                           options="{'no_create': True}"
                                           placeholder="Seleccione órdenes específicas o deje vacío para incluir todas..."/>
                                    <div class="alert alert-light border mt-2 mb-0 py-2" role="alert">
                                        <small>
                                            <i class="fa fa-info-circle me-1 text-info"/>
                                            Si no selecciona órdenes, se incluirán automáticamente todas las órdenes abiertas según los filtros configurados.
                                            Solo se muestran órdenes con saldo pendiente (pagos incompletos).
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer con botones -->
                <footer class="pt-3">
                    <button string="Generar Estado de Cuenta"
                            name="action_print_statement"
                            type="object"
                            class="btn-primary btn-lg"
                            icon="fa-print"
                            data-hotkey="q"/>
                    <button string="Cancelar"
                            class="btn-secondary btn-lg ms-2"
                            special="cancel"
                            data-hotkey="x"/>
                </footer>
            </form>
        </field>
    </record>

    <record id="action_account_statement_wizard" model="ir.actions.act_window">
        <field name="name">Estado de Cuenta</field>
        <field name="res_model">account.statement.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'dialog_size': 'extra-large'}</field>
    </record>
</odoo>